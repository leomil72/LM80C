10 REM       O T H E L L O
20 REM
30 REM  APPARSO PER LA PRIMA VOLTA SULLA RIVISTA
35 REM  PERSONAL SOFWARE NN. 17/18 PER LO ZX81
40 REM  ADATTATO PER L'LM80C COLOR COMPUTER DA
45 REM  LEONARDO MILIANI PARTENDO DA UN LISTATO
50 REM  PER COMMODORE 16 A SUA VOLTA ADATTATO
60 REM  DA A. MOTTA E PUBBLICATO SULLA RIVISTA
70 REM  SUPERCOMMODORE N. 4
90 REM
100 REM
102 REM VARIABILI INIZIALI
103 REM
100 GOSUB8000
110 PRINT:PRINTTAB(9);"O T H E L L O":PRINT
115 DIM AP(99),BP(7),CP(99),DP(99)
120 RESTORE10000:FORI=0TO7:READ BP(I):NEXT
130 FORI=1TO4:FORJ=1TO8:READX:Y=I*10+J
140 AP(Y)=X:AP((4-I)*20+Y+10)=X:NEXT:NEXT
150 DF=3172:DC=2148
200 REM
201 REM INIZIO GIOCO
202 REM
210 FORI=0TO99:CP(I)=0:NEXT
220 FORI=0TO9:CP(I)=9:CP(I+90)=9:NEXT
230 FORI=1TO8:CP(I*10)=9:CP(I*10+9)=9:NEXT
240 CP(44)=1:CP(45)=15:CP(54)=15:CP(55)=1:G=2:C=2:PG=1:PC=1
250 REM
260 LOCATE 0,3:PRINT"IL NERO GIOCA PER PRIMO."
265 LOCATE0,4:PRINTSPC(32);:LOCATE0,4
267 INPUT"QUALE COLORE SCEGLI (B/N)";Z$:Z$=CHR$(ASC(Z$) AND 223)
270 IF Z$<>"B" AND Z$<>"N" THEN 260
280 IF Z$="B" THEN PG=15:GOTO 290
285 PC=15
290 LOCATE0,6:PRINTSPC(32);
292 LOCATE0,6:INPUT"LIVELLO GIOCO (1/2)";Z$
295 IF Z$<>"1" AND Z$<>"2" THEN 290
296 LV=ASC(Z$)-48
298 REM *** DISEGNA SCACCHIERA ***
300 CLS:LOCATE 0,2:PRINT"OTHELLO"
305 LOCATE 0,3:FOR I=0TO6:PRINTCHR$(166);:NEXT
310 LOCATE 13,0:PRINT"1 2 3 4 5 6 7 8"
312 LOCATE 12,1:PRINT CHR$(135);
314 FORI=1TO7:PRINTCHR$(143);CHR$(141);:NEXT:PRINTCHR$(143);CHR$(136)
320 FORI=0TO7:LOCATE11,2+I*2:PRINTCHR$(65+I);
325 FORL=1TO8:PRINTCHR$(144);" ";:NEXTL:PRINTCHR$(144);CHR$(65+I)
328 IF I=7 THEN 334
330 LOCATE 12,2+I*2+1:PRINTCHR$(140);
332 FORL=1TO7:PRINTCHR$(143);CHR$(134);:NEXTL:PRINTCHR$(143);CHR$(142)
334 NEXT
340 LOCATE 12,17:PRINTCHR$(138);
342 FORI=1TO7:PRINTCHR$(143);CHR$(139);:NEXT:PRINTCHR$(143);CHR$(137)
350 LOCATE 13,18:PRINT"1 2 3 4 5 6 7 8"
355 LOCATE 19,8:PRINTCHR$(192);:LOCATE21,8:PRINTCHR$(160);
360 LOCATE 19,10:PRINTCHR$(160);:LOCATE21,10:PRINTCHR$(192);
362 TC=192:IFPC=15THENTC=160
364 TG=192:IFPG=15THENTG=160
370 LOCATE 0,8:PRINT"CPU ";CHR$(TC);" =";C
375 LOCATE 0,10:PRINT"TU  ";CHR$(TG);" =";G
380 LOCATE 0,14:PRINT"LIVELLO";LV
900 IFPG=15THEN2000
1000 REM
1001 REM
1002 REM MOSSA DEL GIOCATORE
1003 REM
1005 FORI=0TO1:SOUND3,3750,0:PAUSE10:SOUND3,3850,0:PAUSE10:NEXT
1007 SOUND 3,0,1:RESTORE10100
1010 LOCATE 0,20:PRINTSPC(32);
1012 LOCATE 0,20:PRINT"LA TUA MOSSA (es. A1) ";:VOLUME 3,9:A=INKEY(0)
1014 READX,Y:IFX=0THENRESTORE10100
1016 SOUND3,X,0:ZZ=INKEY(Y)
1018 IF ZZ=0 THEN 1014
1020 ZZ=ZZ AND 223:IF ZZ<65 OR ZZ>72 THEN 1080
1022 S=(ZZ-64)*10:PRINTCHR$(ZZ);
1024 READX,Y:IFX=0THENRESTORE10100
1026 SOUND3,X,0:SS=INKEY(Y)
1028 IF SS=0 THEN 1024
1030 IF SS<48 OR SS>57 THEN 1080
1040 PRINTCHR$(SS);:SOUND 3,0,1
1050 S=S+(SS-48):PA=PC:PP=PG:M=0:VOLUME 3,15
1070 LOCATE 0,20:PRINTSPC(32);:GOSUB7000:IFM<>OTHEN1100
1080 LOCATE 0,20:PRINT"MOSSA NON PERMESSA - RIPETI     ";
1085 VOLUME 0,15
1090 FORI=4000TO3700STEP-25:SOUND3,I,0:PAUSE 5:NEXT:SOUND 3,0,1
1095 GOSUB6900:GOTO1005
1100 P=S:N=1:GOSUB6800:GOSUB6900:GOSUB6000
1110 C=C-N+1:G=G+N:IFC+G=64THEN4000
1120 GOSUB6700
2000 REM
2001 REM
2002 REM MOSSA CPU
2003 REM
2004 REM
2010 PP=PC:PA=PG:LOCATE0,20
2012 PRINT"ELABORO LA MIA MOSSA...         ";
2015 FORI=3650TO3850STEP50:SOUND 3,I,0:PAUSE 5:NEXT:SOUND 3,0,1
2030 ONLVGOSUB2500,3000
2040 IFQ<>OTHEN2100
2050 LOCATE0,20:PRINT"PASSO IL TURNO";SPC(18);
2060 FORI=4000TO3700STEP-25:SOUND3,I,0:PAUSE 5:NEXT:SOUND 3,0,1
2070 GOSUB6900:GOTO2200
2100 LOCATE0,20:PRINT"LA MIA MOSSA E' ";
2110 PRINTCHR$(INT(Q/10)+64);CHR$(Q-INT(Q/10)*10+48);SPC(14);
2115 FORI=3700TO3950STEP50:SOUND3,I,0:PAUSE 5:NEXT:SOUND 3,0,1
2120 S=Q:P=Q:N=1:GOSUB6800:GOSUB6900:GOSUB6000
2130 C=C+N:G=G-N+1:GOSUB6700:IFC+G=64THEN4000
2200 REM
2201 REM
2202 REM CONTROLLA SE IL GIOCATORE
2203 REM PUO' MUOVERE
2204 REM
2205 REM
2210 M=0:PP=PG:PA=PC:FORS=11TO88:GOSUB7000:IFM<>0THEN2400
2215 NEXT:IFQ=0THEN4000
2220 LOCATE0,20:PRINT"PASSI IL TURNO                  ";
2225 SOUND3,3000,0:PAUSE60:SOUND3,0,1
2230 GOSUB6900:GOTO 2000
2400 GOTO1000
2500 REM
2501 REM
2502 REM SUBROUTINE SCELTA MOSSA
2503 REM CPU AL 1 LIVELLO
2504 REM
2505 REM
2520 Q=0:FORS=11TO88:IFCP(S)<>0THEN2590
2530 IFAP(S)<AP(Q) THEN2590
2560 M=0:GOSUB7010
2570 IFAP(M)=AP(Q)ANDRND(1)<.5THENQ=M
2580 IFAP(M)>AP(Q)THENQ=M
2590 NEXT:RETURN
3000 REM
3001 REM
3002 REM SUBROUTINE SCELTA MOSSA
3003 REM CPU AL 2 LIVELLO
3004 REM
3005 REM
3010 FORI=11TO88:DP(I)=CP(I):NEXT
3020 Q2=-9:PM=0:FORK=11TO88:IFCP(K)<>OTHEN3130
3030 S=K:M=0:GOSUB7010:IFM=0THEN3130
3050 FORI=0TO7:P=M+BP(I):IFCP(P)<>PATHEN3100
3060 P=P+BP(I):IFCP(P)=PATHEN3060
3070 IFCP(P)<>PPTHEN3100
3080 P=P-BP(I):CP(P)=PP:IFP=MTHEN3100
3090 GOTO3080
3100 NEXT:M1=M:PA=PC:PP=PG:Q=0:GOSUB2500
3105 IFQ=0THEN3140
3110 M=AP(M1)-AP(Q):IFM>Q2THENQ2=M:PM=M1
3120 FORI=11TO88:CP(I)=DP(I):NEXT
3130 PP=PC:PA=PG:NEXT:Q=PM:RETURN
3140 FORI=11TO88:CP(I)=DP(I):NEXT
3150 PP=PC:PA=PG:Q=M1:RETURN
4000 REM
4001 REM
4002 REM FINE PARTITA
4003 REM
4004 LOCATE 0,20
4020 IFG>CTHENPRINT" BRAVO - HAI VINTO ";SPC(45);
4030 IFC=GTHENPRINT" STAVOLTA SIAMO PARI ";SPC(43);
4040 IFC>GTHENPRINT" H O    V I N T O !!! ";SPC(42);
4050 RESTORE 10200
4055 READX,Y:SOUND3,X,0:PAUSEY
4060 IFX<>0THEN4055
4065 SOUND 3,0,1:GOSUB6900
4070 LOCATE0,20:PRINTSPC(32);:INPUT"GIOCHI ANCORA (S/N)";Z$
4080 IFZ$="S"THENCLS:GOTO200
4090 IFZ$<>"N"THEN4070
4100 CLS:PRINT"C I A O !":END
4500 LOCATE0,20:PRINT"H O    V I N T O !!!";SPC(12);
6000 REM
6001 REM
6002 REM AGGIORNAMENTO SCACCHIERA
6003 REM
6004 REM
6010 FORI=0TO7:P=S+BP(I):IFCP(P)<>PATHEN6100
6020 P=P+BP(I):IFCP(P)=PATHEN6020
6030 IFCP(P)<>PPTHEN6100
6040 P=P-BP(I):IFP=STHEN6100
6050 GOSUB6800:CP(P)=PP:N=N+1:GOTO6040
6100 NEXT:CP(S)=PP:RETURN
6700 LOCATE7,8:PRINTC:LOCATE7,10:PRINTG:RETURN
6800 X=INT(P/10):Y=P-(X*10):LOCATE 11+(2*Y),2*X
6810 IF PP=1 THEN PRINTCHR$(192);:GOTO6830
6820 PRINTCHR$(160);
6830 RETURN
6900 PAUSE50:RETURN
7000 REM
7001 REM
7002 REM SUBROUTINE CONTROLLO
7003 REM VALIDITA' MOSSA
7004 REM
7005 REM
7006 IFCP(S)<>0THENRETURN
7010 FORI=0TO7:P=S+BP(I):IFCP(P)<>PATHEN7050
7020 P=P+BP(I):IFCP(P)=PATHEN7020
7030 IFCP(P)<>PPTHEN7050
7040 M=S:RETURN
7050 NEXT:RETURN
8000 REM
8010 REM
8020 REM INITIALIZE SCREEN AND BOARD
8030 REM
8040 REM
8050 VOLUME0,15:SCREEN1:VREG7,34:FORI=0TO31:VPOKE8192+I,242:NEXT
8060 RESTORE10300:FORI=0TO7:READX:VPOKE1280+I,X:VPOKE1536+I,X:NEXT
8070 VPOKE8216,18
8080 RETURN
10000 REM
10001 REM
10002 REM DATA
10003 REM
10004 REM
10010 DATA -11,-10,-9,-1,1,9,10,11
10020 DATA 9,2,8,6,6,8,2,9
10030 DATA 2,1,3,4,4,3,1,2
10040 DATA 8,3,7,5,5,7,3,8
10050 DATA 6,4,5,0,0,5,4,6
10100 DATA 3834,14,3798,14,3834,28,4015,1,3834,14,3798,14,3834,28
10110 DATA 3854,14,3834,14,3810,14,3798,14,3770,14,3798,14,3810,14
10120 DATA 3798,7,3810,7,3834,14,3739,14,4015,1,3739,28,4015,1
10130 DATA 3739,7,3770,7,3798,7,3810,7,3834,2,3854,14,3770,14
10140 DATA 4015,1,3770,14,3810,14,3798,14,3770,14,3739,28,0,0
10200 DATA 3881,16,3854,16,3810,16,4015,1,3810,8,4015,1,3810,16
10210 DATA 3739,16,3854,16,3834,32,3739,16,3854,16,3834,32,3739,16
10220 DATA 3834,16,3810,32,3881,16,3854,16,3810,16,4015,1,3810,8
10230 DATA 4015,1,3810,8,3739,16,3854,16,3834,32,3739,16,3854,16
10240 DATA 3834,16,3739,16,3810,40,3810,8,0,0
10300 DATA 60,126,255,255,255,255,126,60
