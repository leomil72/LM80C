10 REM *******************************
20 REM *       LUNAR   LANDER        *
30 REM * ADAPTED BY LEONARDO MILIANI *
40 REM *       FOR LM80C BASIC       * 
50 REM *  FROM A SOURCE FOR C16/+4   *
60 REM *******************************
70 GOSUB 5000:GOSUB 5500
80 SREG 7,&B11011000:SREG 10,31:SREG 13,10:SREG 11,50:SREG 12,0:SREG 6,31
90 REM
100 LOCATE 4,2:PRINT "L U N A R    L A N D E R"
110 LOCATE 6,4:PRINT "by  LEONARDO MILIANI"
112 RESTORE 12000:LOCATE 0,18
114 FOR I=0 TO 31:READ A:PRINT CHR$(A);:NEXT
116 LOCATE 0,19:FOR I=0 TO 31:PRINT CHR$(255);:NEXT
120 FOR I=50 TO 111:VPOKE 6912,I:VPOKE 6920,I+24:PAUSE4:NEXT
122 SREG 7,255
124 VPOKE 6920,223
130 GOSUB 4200
135 LOCATE 0,21:PRINT "Do you need instructions (Y/N)?";
140 A=INKEY(0)
145 A=INKEY(20):IF A=0 THEN 145
150 IF A<>89 AND A<>121 THEN CH=5
160 I4=I5
170 CLS
180 DEF FNO(U)=X0/ABS(V0)
190 X0=(52800+INT((RND(1)-.5)*20000))*2:X0=INT(X0/1000)*1000
200 V0=-470+INT((RND(1)-.5)*100):F=1:S=1:V0=INT(V0/100)*100
210 FL=INT(2000+RND(1)*1000)
220 GOTO 940
230 GOSUB 1280
231 LOCATE 22,16
232 PRINT CHR$(149);:FOR I=1 TO 8:PRINT CHR$(157);:NEXT:PRINT CHR$(150);
233 LOCATE 22,17:PRINT CHR$(158);" LUNAR  ";CHR$(158);
234 LOCATE 22,18:PRINT CHR$(158);" LANDER ";CHR$(158);
235 LOCATE 22,19
236 PRINT CHR$(152);:FOR I=1 TO 8:PRINT CHR$(157);:NEXT:PRINT CHR$(151);
240 GOSUB 600
250 GOSUB 1960
260 GOSUB 6600
270 AT=TI
280 GOSUB 4100:RR=INKEY(30)
285 IF RR>=48 AND RR<=57 THEN R=RR-48:GOSUB 770
290 IF NJ=5 THEN T=T+INT(RND(1)*800)
300 REM IF (TMR(0)-AT)>29 THEN AT=TMR(0):GOTO 320
310 REM GOTO 300
320 T=T+R:IF RR=66 OR RR=98 THEN R=20:GOSUB 770
330 TH=TH+1
333 IF R=0 THEN SREG 7,248:SREG 6,0:SREG 10,0:SREG 13,0:SREG 11,0:SREG 12,0
336 IF R>0 THEN GOSUB 4000
340 A=5.4*(1-0.2*R)
350 X=V0+0.5*A:X0=X0+X
360 IF X0>0 THEN 380
370 X=X-X0:F=0:X0=0
380 D=V0*V0-2*X*A
390 IF D>0 THEN 410
400 D=-D:S=-1
410 V0=SQR(D)*S*SGN(X)
420 S=1
430 F$=STR$(FNO(U))
440 LOCATE 23,3:IF V0>0 THEN PRINT "-";:GOTO 450
445 PRINT " ";
450 PRINT MID$(STR$(V0),2,5)
460 LOCATE 24,6:X0$=LEFT$(STR$(X0),9)
465 TMP$=X0$:GOSUB 560:PRINT TMP$;
470 LOCATE 24,9:PRINT(FL-T);
480 LOCATE 24,12:TMP$=MID$(F$,2,6):PRINT TMP$;
482 GA=160-(INT(X0/826))-8
483 IF GA<8 THEN GA=8:GOTO 485
484 IF GA>160 THEN GA=160
485 VPOKE 6928,GA
490 IF F=0 THEN GOSUB 1590:GOTO 1640:REMGOSUB 770
500 IF X0>280000 THEN 5600
510 IF T>FL THEN 530
520 GOTO 540
530 R=0:GOSUB 770:PAUSE25:GOTO 330
540 FS=FL-T
550 GOTO 280
560 IF ASC(LEFT$(TMP$,1))=32 THEN TMP$=MID$(TMP$,2)
565 LX=LEN(TMP$):IF LX=7 THEN 580
570 FOR I=1TO(7-LX):TMP$=TMP$+" ":NEXT
580 RETURN
587 REM
598 REM *** DRAW THE CONTROL PANEL ***
599 REM
600 RESTORE 11000
610 Y=1
620 FOR I=0 TO 20:LOCATE 1,Y
630 FOR L=0 TO 10:READ A:PRINT CHR$(A);
640 NEXT:Y=Y+1:NEXT
650 Y=1
660 FOR I=0 TO 12:LOCATE 22,Y
670 FOR L=0 TO 9:READ A:PRINT CHR$(A);
680 NEXT:Y=Y+1:NEXT
690 VPOKE 6913,120:VPOKE 6912,70:VPOKE 6921,128
740 RETURN
750 REM
760 REM *** ENGINE MANAGEMENT ***
765 REM
770 R1=R:IF R1=20 THEN VPOKE 8208,&HD0:GOTO 792
790 VPOKE 8208,&H80
792 IF R1>0 THEN VPOKE 6920,95:GOTO 800
794 VPOKE 6920,223
800 Y=2:FOR I=9 TO 1STEP-1
810 IF (I>R1) THEN A$=" ":GOTO 830
820 A$=CHR$(128)
830 LOCATE 10,Y:PRINT A$;:LOCATE 10,Y+1:PRINT A$
840 Y=Y+2:NEXT
850 IF RND(1)>.9997 THEN 865
860 RETURN
865 IF R>7 THEN 875
870 RETURN
875 LOCATE 12,10:PRINT "BLOWOUT!"
880 FOR I=4000 TO 3700 STEP -25:SOUND 3,I,0:PAUSE 5:NEXT:SOUND 3,0,1:PAUSE 30
890 LOCATE 12,10:PRINT SPC(9);
900 PAUSE 100
920 NJ=5
930 RETURN
937 REM
938 REM *** INSTRUCTIONS ***
939 REM
940 CLS
950 VOLUME0,15:VPOKE 6912,223
960 IF CH=5 OR CR>0 OR SA>0 THEN 1150
962 A$="You are aboard a LEM module on":GOSUB 4400:PRINT
964 A$="a routine mission landing on":GOSUB 4400:PRINT
966 A$="our satellite, the MOON.":GOSUB 4400:PRINT
968 PAUSE100:PRINT
970 A$="While descending, a failure":GOSUB 4400:PRINT
971 A$="into the navigation system is":GOSUB 4400:PRINT
972 A$="likely to compromise everything":GOSUB 4400:PRINT
975 PAUSE 100:PRINT
980 A$="To save the LEM and yourself":GOSUB 4400:PRINT
982 A$="you must take over the manual":GOSUB 4400:PRINT
983 A$="controls.":GOSUB 4400:PRINT
984 PAUSE 100:PRINT
985 A$="You can either try for a soft":GOSUB 4400:PRINT
986 A$="landing or try to regain the":GOSUB 4400:PRINT
987 A$="orbit reaching a height of":GOSUB 4400:PRINT
988 A$="280000 ft.":GOSUB 4400:PRINT
989 PAUSE 100:PRINT
990 GOSUB 4500
1000 CLS
1010 A$="The Control Panel shows some":GOSUB 4400:PRINT
1015 A$="gauges to help you land safely:":GOSUB 4400:PRINT
1020 PAUSE 50:A$="> VELOCITY:  in Ft/Sec":GOSUB 4400:PRINT
1030 PAUSE 50:A$="> HEIGHT:    in feet":GOSUB 4400:PRINT
1040 PAUSE 50:A$="> REMAINING FUEL":GOSUB 4400:PRINT
1050 PAUSE 50:A$="> ETML: est. time to moon land":GOSUB 4400:PRINT
1060 A$="  at current speed, in secs.":GOSUB 4400:PRINT
1070 PAUSE 100:PRINT
1075 A$="A negative velocity  (eg., -32)":GOSUB 4400:PRINT
1080 A$="means that you are going up.":GOSUB 4400:PRINT
1085 PAUSE 100:PRINT
1090 A$="The rockets controls are the":GOSUB 4400:PRINT
1095 A$="number keys. Higher numbers for":GOSUB 4400:PRINT
1100 A$="harder thrusts.":GOSUB 4400:PRINT
1110 PAUSE 100:PRINT
1130 A$="The >B< key will give you a":GOSUB 4400:PRINT
1135 A$="boost of 20.":GOSUB 4400:PRINT
1140 PAUSE 100:PRINT
1145 GOSUB 4500
1150 CLS
1151 A$="     INITIAL   CONDITIONS      ":GOSUB 4400:PRINT
1152 PAUSE100:PRINT:PRINT
1156 A$="You will start at"+STR$(X0)+" ft.":GOSUB 4400:PRINT
1160 A$="Your speed is"+STR$(ABS(V0))+" Ft/Sec.":GOSUB 4400:PRINT
1170 A$="You have"+STR$(FL)+" units of fuel.":GOSUB 4400:PRINT
1190 PAUSE 100:PRINT
1191 A$="You must land with speed less":GOSUB 4400:PRINT
1192 A$="than 15 Ft/Sec..":GOSUB 4400:PRINT:PRINT
1200 GOSUB 4500:PRINT
1230 PRINT "OK, LET'S GO!":PAUSE50:GOTO 230
1269 REM
1270 REM  *** DRAW THE STARRY SKY ***
1271 REM
1280 CLS:FOR I2=1 TO 21
1310 LOCATE 12,I2:FOR I1=1 TO 10
1340 A=RND(1)
1350 IF A>.2 THEN PRINT " ";:GOTO 1380
1355 IF A>.1 THEN PRINT ".";:GOTO 1380
1360 IF A>.05 THEN PRINT "+";:GOTO 1380
1370 PRINT "*";
1380 NEXT
1430 NEXT
1580 RETURN
1590 REM
1600 VPOKE 6912,223:VPOKE 6920,223:VPOKE 6928,223:CLS:LOCATE 0,20
1610 RESTORE 12000:FOR I=0 TO 31:READ A:PRINT CHR$(A);:NEXT
1620 LOCATE 0,21:FOR I=0 TO 31:PRINT CHR$(255);:NEXT I
1630 RETURN
1632 REM
1634 REM *** LANDING ***
1636 REM
1640 LOCATE 0,0:A=3:IF V0<-15 THEN A=1
1645 SREG 7,&B11011000:SREG 10,31:SREG 13,12:SREG 11,0:SREG 12,1:SREG 6,31
1647 VPOKE 6913,112:VPOKE 6921,120
1650 FOR I=0 TO 128:VPOKE 6912,I
1652 IF R>0 THEN VPOKE 6920,I+25
1654 PAUSE A:NEXT
1655 SREG 7,255:SREG 10,0:SREG 13,0:SREG 11,0:SREG 12,0
1660 IF R>0 THEN VPOKE 6920,223
1665 IF V0<-15 THEN 1740
1670 PRINT
1674 FOR I=3600 TO 4000 STEP 5:SOUND 1,I,0:SOUND 2,I-50,0:PAUSE 2:NEXT
1676 SOUND 1,0,1:SOUND 2,0,1
1680 IF FS<200  THEN PRINT "You made it!!! Very close!!!"
1690 IF FS>200 AND FS<700  THEN PRINT "Talk about close encounters!!!"
1700 IF FS>700 AND FS<1600  THEN PRINT "Great work !!"FS"fuel left!"
1710 IF FS>1600  THEN PRINT "Wonderful!!! Great Landing!!!"
1720 PRINT
1730 SA=SA+1:GOTO 1860
1740 PRINT "CRASH!!!"
1745 VPOKE 8215,&H90:VPOKE 6920,223
1750 CL=1:FOR I=16 TO 20:LOCATE 14,I:FOR L=1 TO 4
1755 PRINT CHR$(187);:VREG 7,CL:CL=CL+1:IF CL>15 THEN CL=1
1760 NEXT:NEXT:VREG 7,0
1770 VPOKE 6912,223:GOSUB 4200
1775 FOR I=16 TO 20:LOCATE 14,I:PRINT "    ";:NEXT
1780 LOCATE 0,2
1790 IF FS<1 THEN PRINT "You were a bit heavy on th throttle"
1800 IF FS>0 AND -V0<50 THEN PRINT "You nearly made it. Too bad."
1810 IF FS>0 AND -V0>50 AND -V0<150 THEN PRINT "I'm sure you'll get better!"
1820 IF FS>0 AND -V0>150 AND -V0<250 THEN PRINT "Go back to Astronaut school !"
1830 IF FS>0 AND -V0>250 THEN GOSUB 2200
1850 PRINT:CR=CR+1:GOTO 1860
1860 PRINT "Hit >R< for replay, >E< to exit ";:T=0:R=0:NJ=0
1865 A=INKEY(0)
1870 A=INKEY(20):IF A=0 THEN 1870
1880 IF A=69 OR A=101 THEN 2020
1890 IF A=82 OR A=114 THEN PRINT "Restart...":PAUSE 100:GOTO 150
1900 GOTO 1870
1960 FOR A=5 TO 1STEP-1
1970 LOCATE 0,23
1980 PRINT "   MANUAL CONTROL IN";A;"SECONDS";:SOUND 3,3800,10:PAUSE 70
1990 LOCATE 0,23:PRINT SPC(31);:PAUSE30:NEXT
2000 LOCATE 0,23:PRINT "    MANUAL CONTROL ENGAGED     ";
2002 SOUND 3,2500,40:PAUSE 70
2005 LOCATE 0,23:PRINT SPC(31);
2010 RETURN
2020 VPOKE 6912,223:VPOKE 6920,223:CLS
2030 PRINT "You crashed "CR"times,"
2040 PRINT "Landed safely"SA"times"
2050 IF CX>0 THEN PRINT "and went into orbit"CX"times."
2060 IF CR+2>SA THEN PRINT "You need more practice."
2070 IF SA>CR OR SA=CR THEN PRINT "Are you learning to like this  game?"
2080 IF SA=1  AND CR>3 THEN PRINT "Do you get a kick off of crashing?"
2090 IF CR=<2 AND SA>CR+1 THEN PRINT "Good work !!!"
2100 END
2200 PRINT "That's a"INT(SQR(ABS(V0)))"MEGATON landing!!"
2210 RETURN
3998 REM *** GENERATE ENGINE NOISE ***
4000 RS=R:IF R>10 THEN RS=10
4002 SREG 7,&B11011000:SREG 10,31:SREG 13,12:SREG 11,0:SREG 12,1:SREG 6,31
4005 SREG 6,20-RS:SREG 7,&B11011111:POKE&H8177,10:RETURN
4098 REM *** GENERATE A CONTROL PANEL "BEEPING" SOUND ***
4100 SOUND 1,RND(1)*100+3950,10:SOUND 2,RND(1)*100+3850,10:RETURN
4198 REM *** SIMULATE A SYSTEM DOWN SOUND ***
4200 SREG 10,15:SREG 7,&B11011111:FOR I=0 TO 31:SREG 6,I:PAUSE 5:NEXT
4210 SREG 10,0:SREG 7,255:RETURN
4300 SOUND 3,RND(1)*400+400,10:RETURN
4398 REM *** PRINT A TEXT SIMULATING A PRINTING NOISE ***
4400 FOR I=1 TO LEN(A$)
4410 PRINT MID$(A$,I,1);:SOUND 1,100,2:PAUSE 3
4420 NEXT
4440 RETURN
4497 REM
4498 REM *** WAIT FOR A KEY AND RETURN ***
4499 REM
4500 PRINT "Press any key to continue":A=INKEY(0)
4510 A=INKEY(20):IF A=0 THEN 4510
4520 RETURN
4996 REM
4997 REM *** SCREEN CONFIG ***
4998 REM
5000 SCREEN 1:VREG 7,1:VREG 1,&B11000011:REM SET SPRITES TO 32X32
5010 FOR I=0 TO 19:VPOKE 8192+I,&HF0:NEXT:REM WHITE CHARS ON BLACK
5020 FOR I=20 TO 31:VPOKE 8192+I,&HE0:NEXT:REM GRAY ROCKS ON BLACK
5030 RESTORE 11500:FOR I=0 TO 7:READ A:VPOKE 1024+I,A:NEXT
5040 VPOKE 8208,&H80:RETURN
5497 REM
5498 REM *** SPRITES SETUP ***
5499 REM
5500 RESTORE 10000:FOR I=0 TO 31:READ A:VPOKE 14336+I,A:NEXT
5510 VPOKE 6912,50:VPOKE 6912+1,112:REM +0=Y; +1=X
5520 VPOKE 6912+2,0:VPOKE 6912+3,5:REM +2=NAME; +3=COLOR
5530 FOR I=0 TO 7:READ A:VPOKE 14368+I,A:NEXT
5535 FOR I=8 TO 31:VPOKE 14368+I,0:NEXT
5540 VPOKE 6920,75:VPOKE 6921,120:VPOKE 6922,4:VPOKE 6923,9
5550 FOR I=0 TO 7:READ A:VPOKE 14400+I,A:NEXT
5555 FOR I=8 TO 31:VPOKE 14400+I,0:NEXT
5560 VPOKE 6928,223:VPOKE 6929,56:VPOKE 6930,8:VPOKE 6931,11
5570 VPOKE 6932,208:REM TO STOP THE SPRITE PROCESSING
5580 RETURN
5597 REM
5598 REM *** RETURN INTO ORBIT ***
5599 REM
5600 CLS:VPOKE 6912,223:VPOKE 6920,223:VPOKE 6928,223
5605 LOCATE 0,3:PRINT "You have decided to regain orbit"
5610 PRINT "This means you soon reach the"
5620 PRINT "orbital module."
5630 TM=TI:GOSUB 6600:PRINT:PRINT "It took you ";(TI-TM)/100;"s. to"
5640 PRINT "return into orbit.":CX=CX+1:PRINT
5650 GOTO 1860
6597 REM
6598 REM *** TIME CALCULATION ***
6599 REM
6600 TL=TMR(0):IF TL<0 THEN TL=65536+TL
6610 TH=TMR(1):IF TH<0 THEN TH=65536+TH
6620 TI=(TH*65536)+TL
6630 RETURN
9997 REM
9998 REM *** GAME DATA ***
9999 REM LEM SPRITE
10000 DATA 16,23,31,31,62,60,60,30
10010 DATA 63,60,63,113,99,64,64,224
10020 DATA 2,229,250,248,124,60,60,120
10030 DATA 252,60,252,142,198,2,2,7
10040 REM FIRE SPRITE
10050 DATA 60,126,126,126,60,60,24,0
10060 REM GAUGE METER
10070 DATA 32,96,224,96,32,0,0,0
10999 REM CONTROL PANEL
11000 DATA 149,157,157,157,157,155,157,155,157,157,150
11010 DATA 158,32,32,32,32,154,32,158,57,32,158
11020 DATA 158,32,32,32,32,154,32,158,32,32,158
11030 DATA 158,49,48,48,75,154,32,158,56,32,158
11040 DATA 158,32,32,32,32,154,32,158,32,32,158
11050 DATA 158,32,32,32,32,154,32,158,55,32,158
11060 DATA 158,32,32,32,32,154,32,158,32,32,158
11070 DATA 158,32,55,53,75,154,32,158,54,32,158
11080 DATA 158,32,32,32,32,154,32,158,32,32,158
11090 DATA 158,32,32,32,32,154,32,158,53,32,158
11100 DATA 158,32,32,32,32,154,32,158,32,32,158
11110 DATA 158,32,53,48,75,154,32,158,52,32,158
11120 DATA 158,32,32,32,32,154,32,158,32,32,158
11130 DATA 158,32,32,32,32,154,32,158,51,32,158
11140 DATA 158,32,32,32,32,154,32,158,32,32,158
11150 DATA 158,32,50,53,75,154,32,158,50,32,158
11160 DATA 158,32,32,32,32,154,32,158,32,32,158
11170 DATA 158,32,32,32,32,154,32,158,49,32,158
11180 DATA 158,32,32,32,32,154,32,158,32,32,158
11190 DATA 158,32,32,32,48,154,32,158,48,128,158
11200 DATA 152,157,157,157,157,153,157,153,157,157,151
11210 DATA 149,157,157,157,157,157,157,157,157,150
11220 DATA 158,32,83,80,69,69,68,32,32,158
11230 DATA 158,32,32,32,32,32,32,32,32,158
11240 DATA 154,157,157,157,157,157,157,157,157,156
11250 DATA 158,32,72,69,73,71,72,84,32,158
11260 DATA 158,32,32,32,32,32,32,32,32,158
11270 DATA 154,157,157,157,157,157,157,157,157,156
11280 DATA 158,32,32,70,85,69,76,32,32,158
11290 DATA 158,32,32,32,32,32,32,32,32,158
11300 DATA 154,157,157,157,157,157,157,157,157,156
11310 DATA 158,32,32,69,84,77,76,32,32,158
11320 DATA 158,32,32,32,32,32,32,32,32,158
11330 DATA 152,157,157,157,157,157,157,157,157,151
11500 DATA 0,0,255,255,255,255,0,0
11999 REM LANDSCAPE
12000 DATA 162,163,164,255,255,163,162,162,32,162,163,164,164,164
12010 DATA 255,255,255,255,164,163,162,32,32,162,163,162,163,164
12020 DATA 163,163,164,164
